#!/bin/sh

if ! command -v yadm &> /dev/null; then
    echo "Use local yadm at $HOME/yadm"
    yadm="sh $HOME/yadm"
else
    yadm=yadm
fi

echo "Installing YADM"
if [ -n ${GITHUBURL+x} ]; then
    echo "Use github url: $GITHUBURL"
    # use a tempdir from mirror as a reference to boost init
    tempdir=$(mktemp -d)
    git clone "https://$GITHUBURL/TheLocehiliosan/yadm" $tempdir
    $yadm submodule update --init --recursive --reference $tempdir --dissociate
    rm -rf $tempdir
else
    $yadm submodule update --init --recursive
fi
echo "YADM installed"

# sparse checkout to avoid  README.md and LICENSE in HOME
rm -f ~/README.md LICENSE
$yadm gitconfig core.sparseCheckout true
$yadm sparse-checkout set '/*' '!README.md' '!LICENSE'
